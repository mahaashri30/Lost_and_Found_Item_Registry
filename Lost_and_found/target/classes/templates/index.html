<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout :: head('Home')"></head>
<body>
<!-- Hero Section -->
<div class="hero-section text-center text-white">
    <div class="container position-relative">
        <h1 class="display-4 fw-bold animate">Campus Lost & Found</h1>
        <p class="lead animate animate-delay-1">Report lost items, claim found ones, and reunite belongings with their owners.</p>
        <div class="mt-4 animate animate-delay-2">
            <a href="/items/report" class="btn btn-light btn-lg me-3">
                <i class="bi bi-plus-circle"></i> Report Item
            </a>
            <a href="/items/search" class="btn btn-outline-light btn-lg">
                <i class="bi bi-search"></i> Search Items
            </a>
        </div>
    </div>
</div>

<!-- Stats Cards -->
<div class="container py-5">
    <div class="row g-4">
        <div class="col-md-4">
            <div class="card text-center p-4 shadow-sm">
                <div class="display-5 text-danger"><i class="bi bi-x-circle"></i></div>
                <h5>Lost Items</h5>
                <h3 id="lost-count" class="fw-bold">--</h3>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center p-4 shadow-sm">
                <div class="display-5 text-success"><i class="bi bi-check-circle"></i></div>
                <h5>Found Items</h5>
                <h3 id="found-count" class="fw-bold">--</h3>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center p-4 shadow-sm">
                <div class="display-5 text-warning"><i class="bi bi-hand-thumbs-up"></i></div>
                <h5>Recovered</h5>
                <h3 id="recovered-count" class="fw-bold">--</h3>
            </div>
        </div>
    </div>
</div>

<!-- Recent Items with Images -->
<div class="container pb-5">
    <h2 class="text-center mb-4">Recently Reported Items</h2>
    <div class="row g-4" id="recent-items">
        <!-- Filled by JS -->
    </div>
</div>

<footer th:replace="layout :: footer"></footer>

<script>
    function getCategoryImage(category) {
        const images = {
            'ELECTRONICS': 'https://picsum.photos/seed/electronics/400/250',
            'CLOTHING': 'https://picsum.photos/seed/clothing/400/250',
            'ACCESSORIES': 'https://picsum.photos/seed/accessories/400/250',
            'DOCUMENTS': 'https://picsum.photos/seed/documents/400/250',
            'OTHER': 'https://picsum.photos/seed/other/400/250',
            'DEFAULT': 'https://picsum.photos/seed/item/400/250'
        };
        return images[category] || images.DEFAULT;
    }

    async function loadDashboard() {
        try {
            const [lostRes, foundRes, allRes] = await Promise.all([
                fetch('/api/reports/lost-items'),
                fetch('/api/reports/found-items'),
                fetch('/api/items')
            ]);

            const lost = await lostRes.json();
            const found = await foundRes.json();
            const all = await allRes.json();
            const recovered = all.filter(item => item.status === 'RECOVERED');

            document.getElementById('lost-count').textContent = lost.length;
            document.getElementById('found-count').textContent = found.length;
            document.getElementById('recovered-count').textContent = recovered.length;

            // Show 6 most recent
            const recent = all.slice(0, 6);
            const container = document.getElementById('recent-items');
            container.innerHTML = recent.map(item => `
          <div class="col-md-6 col-lg-4">
            <div class="card h-100">
              <img src="${getCategoryImage(item.category)}" class="card-img-top" alt="${item.name}">
              <div class="card-body d-flex flex-column">
                <h6 class="card-title">${item.name}</h6>
                <small class="text-muted mb-2">${item.category || 'Uncategorized'}</small>
                <p class="card-text flex-grow-1">${item.description?.substring(0, 80)}${item.description?.length > 80 ? '...' : ''}</p>
                <p class="mb-1"><i class="bi bi-geo-alt"></i> ${item.location}</p>
                <span class="badge rounded-pill mt-2 status-${item.status.toLowerCase()}">${item.status}</span>
              </div>
            </div>
          </div>
        `).join('');
        } catch (e) {
            console.error("Failed to load dashboard:", e);
        }
    }

    loadDashboard();
</script>
</body>
</html>